@using Harmony.Domain.Enums;
@inject Microsoft.Extensions.Localization.IStringLocalizer<CreateBoardModal> _localizer

@if (!_loading)
{
    <MudDialog>
        <TitleContent>
            @{
                <MudText Typo="Typo.h6">
                    <MudIcon Icon="@Icons.Material.Filled.Dashboard" Class="mr-3 mb-n1" />
                    @_localizer["Edit card"]
                </MudText>
            }
        </TitleContent>
        <DialogContent>
            <MudTextField For="@(() => _card.Name)" @bind-Value="_card.Name" Label="@_localizer["Title"]" />
            <PostTextEditor Contents="@_card.Description" @ref="_textEditor"></PostTextEditor>
            <MudButton OnClick="SaveDescription">@_localizer["Save"]</MudButton>

            <MudTextField T="string" @bind-Value="NewListName" Placeholder="Add new checklist"></MudTextField>
            <MudButton OnClick="AddCheckList">@_localizer["Add"]</MudButton>
            @foreach(var checkList in _card.CheckLists)
            {
                <MudCard>
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h6">@checkList.Title</MudText>
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Default" />
                        </CardHeaderActions>
                    </MudCardHeader>
                    <MudCardContent>
                        @foreach(var item in checkList.Items)
                        {
                            <MudSwitch @bind-Checked="@item.IsChecked" Label="Success" Color="Color.Success" />
                            <MudTextField For="@(() => item.Description)" @bind-Value="item.Description" Label="@_localizer["Description"]" />
                            <MudTextField T="DateTime?" For="@(() => item.DueDate)" @bind-Value="item.DueDate" Format="yyyy-MM-dd" Label="Due date" InputType="InputType.Date" />
                        }
                    </MudCardContent>
                    <MudCardActions>
                        @if (checkList.NewItem != null)
                        {
                            <MudTextField For="@(() => checkList.NewItem.Description)" @bind-Value="checkList.NewItem.Description" Label="@_localizer["Description"]" />
                            <MudTextField T="DateTime?" For="@(() => checkList.NewItem.DueDate)" @bind-Value="checkList.NewItem.DueDate" Format="yyyy-MM-dd" Label="Due date" InputType="InputType.Date" />
                            <MudButton Variant="Variant.Text" OnClick="() => AddCheckListItem(checkList.NewItem)" Color="Color.Primary">@_localizer["Add item"]</MudButton>
                            <MudButton Variant="Variant.Text" OnClick="() => checkList.NewItem = null" Color="Color.Primary">@_localizer["Cancel"]</MudButton>
                        }
                        else
                        {
                            <MudButton Variant="Variant.Text" OnClick="() => checkList.NewItem = new() { CheckListId = checkList.Id }" Color="Color.Primary">@_localizer["Add item"]</MudButton>
                        }
                    </MudCardActions>
                </MudCard>
            }
        </DialogContent>
    </MudDialog>
}