@using Harmony.Application.Features.Boards.Queries.GetBoardUsers;
@using Harmony.Application.Features.Boards.Queries.SearchBoardUsers;
@using Harmony.Application.Features.Workspaces.Queries.GetWorkspaceUsers;
@using Harmony.Domain.Enums;
@inject Microsoft.Extensions.Localization.IStringLocalizer<BoardMembersModal> _localizer

<MudDialog>
    <TitleContent>
        @{
            <MudText Typo="Typo.h6">
                <MudIcon Icon="@Icons.Material.Filled.Dashboard" Class="mr-3 mb-n1" />
                @_localizer["Share Board"]
            </MudText>
        }
    </TitleContent>
    <DialogContent>
        <MudPaper Elevation="25">
            <MudToolBar>
                <MudAutocomplete DebounceInterval="300" ShowProgressIndicator="_searching" T="SearchBoardUserResponse" Label="Search users" @bind-Value="_newBoardMember"
                                 SearchFunc="@SearchUsers" ToStringFunc="@(e=> e==null?null : $"{e.FullName} ({e.UserName})")">
                    <BeforeItemsTemplate>
                        <MudText Color="Color.Primary" Class="px-4 py-1">Always Shows Before List</MudText>
                    </BeforeItemsTemplate>
                    <ItemTemplate>
                        <MudPaper Class="pa-4">
                            <MudStack Row="true">
                                <MudAvatar Color="Color.Secondary">@(context.FirstName[0])</MudAvatar>
                                <MudStack Justify="Justify.Center" Spacing="0">
                                        <MudText Typo="Typo.body1">@context.FullName</MudText>
                                        <MudText Typo="Typo.body2">@@@context.UserName</MudText>
                                </MudStack>
                            </MudStack>
                        </MudPaper>
                    </ItemTemplate>
                </MudAutocomplete>
                    <MudSelect T="UserBoardAccess" Disabled="_newBoardMember == null" @bind-Value="_newBoardMemberAccessLevel"
                            Label="Access" AnchorOrigin="Origin.BottomCenter" Style="width:45px">
                        <MudSelectItem Value="@(UserBoardAccess.Member)" />
                        <MudSelectItem Value="@(UserBoardAccess.Observer)" />
                        <MudSelectItem Value="@(UserBoardAccess.Admin)" />
                    </MudSelect>
                <MudSpacer />
                <MudIconButton Icon="@Icons.Material.Outlined.Notifications" />
                <MudIconButton Icon="@Icons.Material.Outlined.PushPin" />
                <MudIconButton Icon="@Icons.Material.Outlined.PeopleAlt" />
                <MudIconButton Icon="@Icons.Material.Outlined.MoreVert" Color="Color.Inherit" />
            </MudToolBar>
        </MudPaper>
        @foreach(var member in _boardMembers)
        {
            <MudStack>
                <MudPaper Class="pa-4">
                    <MudStack Row="true">
                        <MudAvatar Color="Color.Secondary">@(member.FirstName[0])</MudAvatar>
                        <MudStack Justify="Justify.Center" Spacing="0">
                            <MudText Typo="Typo.body1">@member.FullName</MudText>
                            <MudText Typo="Typo.body2">@@@member.UserName</MudText>
                        </MudStack>
                    </MudStack>
                </MudPaper>
            </MudStack>
        }
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Filled" OnClick="Cancel">@_localizer["Cancel"]</MudButton>
        <MudButton Disabled="@(_processing || _newBoardMember == null)" OnClick="ShareBoard"
                   ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">
            @if (_processing)
            {
                <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                <MudText Class="ms-2">@_localizer["Processing"]</MudText>
            }
            else
            {
                <MudText>@_localizer["Share"]</MudText>
            }
        </MudButton>
    </DialogActions>
</MudDialog>