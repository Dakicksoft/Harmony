@page "/projects/{id}/sprints"
@inject Microsoft.Extensions.Localization.IStringLocalizer<Sprints> _localizer
@using Harmony.Application.Features.Boards.Queries.GetBacklog
@using Harmony.Application.Features.Boards.Queries.GetSprints
@using Harmony.Application.Features.Boards.Queries.GetSprintsDetails
@using Harmony.Application.Helpers
@using Harmony.Client.Infrastructure.Helper
@using Harmony.Domain.Enums

<style>
    .mud-table-cell-custom-group {
        font-weight: 500;
    }

    .mud-table-cell-custom-group-footer {
        padding-bottom: 50px;
        text-align: right;
    }
</style>

<MudTable Hover="true" Elevation="25"
          T="SprintDetails"
          ServerData="@(new Func<TableState, Task<TableData<SprintDetails>>>(ReloadData))" Dense="true" Striped="true" @ref="_table">
    <ToolBarContent>
        <div class="justify-center mud-text-align-center">
            @* <MudCheckBox @bind-Checked:get="@_filterMembersOnly" @bind-Checked:set="ToggleFilterMembers" Label="Members only"></MudCheckBox> *@
        </div>
        <MudSpacer />
        <MudTextField T="string" DebounceInterval="300" Immediate="true" ValueChanged="@(s=>OnSearch(s))" Clearable="true" Placeholder="Search user.." Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh><MudTableSortLabel SortBy="new Func<SprintDetails, object>(x => x.Name)">Name</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<SprintDetails, object>(x => x.Status)">Status</MudTableSortLabel></MudTh>
        <MudTh>Date</MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<SprintDetails, object>(x => x.TotalCards)">Cards</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<SprintDetails, object>(x => x.StoryPoints)">Story points</MudTableSortLabel></MudTh>
        <MudTh Style="text-align:right"></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name">
            <MudHighlighter Text="@context.Name" HighlightedText="@_searchString" />
        </MudTd>
        <MudTd DataLabel="Status">
            <MudHighlighter Text="@context.Status.ToString()" HighlightedText="@_searchString" />
        </MudTd>
        <MudTd DataLabel="Date">
            <MudHighlighter Text="@($"{context.StartDate?.ToString("MMMM dd")} - {context.EndDate?.ToString("MMMM dd")}")" HighlightedText="@_searchString" />
        </MudTd>
        <MudTd DataLabel="TotalCards">
            <MudHighlighter Text="@context.TotalCards.ToString()" HighlightedText="@_searchString" />
        </MudTd>
        <MudTd DataLabel="StoryPoints">
            <MudChip Variant="Variant.Text" Color="Color.Primary">
                @(context.StoryPoints == 0 ? "-" : context.StoryPoints)
            </MudChip>
            <MudHighlighter Text="@context.StoryPoints.ToString()" HighlightedText="@_searchString" />
        </MudTd>
        <MudTd DataLabel="Actions" Style="text-align:right">
            <MudMenu Label="Actions" AnchorOrigin="Origin.BottomLeft" Variant="Variant.Filled">
                <MudMenuItem OnClick="@(() => EditSprint(context))" IconSize="Size.Small" 
                    IconColor="Color.Primary" Icon="@Icons.Material.Filled.Edit">EDIT</MudMenuItem>
            </MudMenu>
        </MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>

